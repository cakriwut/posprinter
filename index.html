
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>print Demo</title>
    </title>
    <link href="https://cdn.bootcdn.net/ajax/libs/mui/3.7.1/css/mui.min.css" rel="stylesheet">
    <style>
        @charset"utf-8";

        html {
            color: #000;
            background: #fff;
            overflow-y: scroll;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%
        }

        html * {
            outline: 0;
            -webkit-text-size-adjust: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0)
        }

        html,
        body {
            font-family: sans-serif
        }

        body,
        div,
        dl,
        dt,
        dd,
        ul,
        ol,
        li,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        pre,
        code,
        form,
        fieldset,
        legend,
        input,
        textarea,
        p,
        blockquote,
        th,
        td,
        hr,
        button,
        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        hgroup,
        menu,
        nav,
        section {
            margin: 0;
            padding: 0
        }

        input,
        select,
        textarea {
            font-size: 100%
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        abbr,
        acronym {
            border: 0;
            font-variant: normal
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 500
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: 100%;
            font-weight: 500
        }

        q:before,
        q:after {
            content: ''
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a:hover {
            text-decoration: underline
        }

        ins,
        a {
            text-decoration: none
        }

        .contianer {
            padding: 0.3rem 0.2rem;
        }

        .mobile-select-box {
            position: relative;
            display: inline-block;
        }

        .mobile-select-box .mobile-select-selectd {
            width: 3rem;
            height: 0.62rem;
            line-height: 0.63rem;
            color: #666;
            border-radius: 0.15rem;
            border: 1px solid #ddd;
            padding: 0 0.5rem;
            font-size: 0.3rem;
            cursor: pointer;
            position: relative;
        }

        .mobile-select-box .mobile-select-selectd::after {
            border: 0.1rem solid transparent;
            content: ' ';
            height: 0;
            position: absolute;
            width: 0;
            top: 0.23rem;
            border-top: 0.15rem solid #666;
            right: 0.15rem;

        }

        .mobile-select-box.focus .mobile-select-selectd {
            box-shadow: 0 0.1rem 0.5rem rgb(0 0 0 / 20%);
        }

        .mobile-select-box .mobile-select-list {
            width: 100%;
            border-radius: 0.1rem;
            box-shadow: 0 0.1rem 0.5rem rgb(0 0 0 / 20%);
            background-color: #fff;
            padding: 0.3rem 0;
            position: absolute;
            top: 0.85rem;
            left: 0;
            z-index: 999;
            display: none;
        }

        .mobile-select-box .mobile-select-list::before {
            border: 0.1rem solid transparent;
            content: ' ';
            height: 0;
            position: absolute;
            width: 0;
            top: -0.24rem;
            border-bottom: 0.15rem solid #fff;
            box-shadow: 0 0.1rem 0.5rem rgb(0 0 0 / 20%);
            right: 0.3rem;
        }

        .mobile-select-box .mobile-select-list .mobile-select-list-item:hover {
            background-color: rgba(189, 176, 176, 0.3);
        }

        .mobile-select-box .mobile-select-list .mobile-select-list-item.selectd {
            color: rgb(131, 121, 244);
        }

        .mobile-select-box .mobile-select-list .mobile-select-list-item {
            padding: 0 0.5rem;
            line-height: 0.64rem;
            cursor: pointer;
        }

        .print-box {
            display: flex;
            justify-content: space-around;
            /* justify-content: space-between; */
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .print-box .print-box-item:hover {
            box-shadow: 0 0.1rem 0.5rem rgb(0 0 0 / 20%);
        }

        .print-box .print-box-item {
            width: 3rem;
            height: 2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-bottom: 0.2rem;
            border-radius: 0.1rem;
            background-color: #ddd;
        }
    </style>
    <style>
        html {
            border: 0px solid #FFFFFF !important;
        }

        body {
            font-size: 12px !important;
            font-family: Arial;
            background-color: #F5F5F5;
            color: #333333;
            border: 0px solid #FFFFFF !important;
        }

        #PrintContent {
            width: 556px;
            padding: 20px 10px;
            line-height: 35px;
            overflow: auto;
            background-color: #FFFFFF;
            border: 0px solid #FFFFFF !important;
        }

        .clearboth {
            clear: both;
        }

        .fs12 {
            font-size: 12px !important;
        }

        .fs13 {
            font-size: 13px !important;
        }

        .fs16 {
            font-size: 28px !important;
        }

        .fs18 {
            font-size: 30px !important;
        }

        .fs28 {
            font-size: 28px !important;
        }

        .fs22 {
            font-size: 28px !important;
        }

        .center {
            text-align: center;
        }

        .left {
            float: left;
        }

        .right {
            float: right;
        }

        .mgt5 {
            margin-top: 5px;
        }

        .mgt10 {
            margin-top: 20px;
        }

        .pdt20 {
            padding-top: 20px;
        }

        .pdt10 {
            padding-top: 20px;
        }

        .line {
            border-bottom: 1px dotted #333333;
            height: 5px;
        }

        .middle {
            position: absolute;
            right: 80px;
            width: 20px;
            text-align: center;
        }

        .relative {
            position: relative;
        }

        .mgl20 {
            margin-left: 20px;
        }

        .PrintEvent {
            width: 90px;
            height: 35px;
            font-size: 28px;
            background-color: #0050F1;
            color: #FFFFFF;
            text-align: center;
            border: 0px;
            margin: 20px auto;
            display: inherit;
            border-radius: 5px;
            cursor: pointer;
        }

        .PrintEvent:hover {
            background-color: #0146d2;
        }
    </style>
</head>

<body>
    <div class="contianer">
        <div class="mobile-select-box">
            <div class="mobile-select-selectd">local IP</div>
            <div class="mobile-select-list">
                <div class="mobile-select-list-item">Custom IP</div>
                <div class="mobile-select-list-item selectd">Local IP</div>
            </div>
        </div>
        <div class="print-box">
           
            <div class="print-box-item">
                print Image
            </div>
        </div>
    </div>
    </div>

    <div id="setFont" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">DEFAULT</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">MONOSPACE </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">DEFAULT_BOLD </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">SANS_SERIF </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">SERIF </a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#printText"><b>cancel</b></a>
            </li>
        </ul>
    </div>
    <div id="setAlignment" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">left（default）</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">center</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">right</a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#setAlignment"><b>cancel</b></a>
            </li>
        </ul>
    </div>
    <div id="setTextStyle" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">NORMAL </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">BOLD </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">ITALIC </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">BOLD_ITALIC </a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#setTextStyle"><b>cancel</b></a>
            </li>
        </ul>
    </div>
    <div id="printText" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">default </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">Word wrap </a>
            </li>

        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#printText"><b>cancel</b></a>
            </li>
        </ul>
    </div>
    <div id="alignModel" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">left（default） </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">center </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">right </a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#printText"><b>cancel</b></a>
            </li>
        </ul>
    </div>
    <div id="printImagesAlignModel" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">left </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">center（default） </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">right </a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#printText"><b>cancel</b></a>
            </li>
        </ul>
    </div>


    <div id="setBarCodeContentPrintPos" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">no print</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#"> Above barcode </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">Below the barcode </a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#"> barcode are printed above and below </a>
            </li>

        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#setBarCodeContentPrintPos"><b>cancel</b></a>
            </li>
        </ul>
    </div>
    <div id="printImages">

        <div id="PrintContent">
            <div style="padding-top:10px;width: 100%;text-align: center;">
                <!-- <img src="https://frontier.qwaiting.com/images/logo/1646371560.png"> -->
                <img src="https://mp.imin.sg/Static/img/logo2.png">
            </div>
            <div style="text-align:center;font-size: 30px;margin-top: 10px;">The Frontier Community Club</div>
            <div style="text-align:center;margin-top: 20px;font-size: 28px;">
                REG Nn：200501519R<br>
                GST No.：20-0501519-R
            </div>
            <div style="font-size: 28px;text-align:center;margin-top:20px;width: 100%;">
                2 Orchand Turn，#B3-25/26，ION Orchand
            </div>        
        </div>
    </div>
</body>

</html>

<script>
    ! function () {
        var a =
            "@charset \"utf-8\";html{color:#000;background:#fff;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}html *{outline:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}html,body{font-family:sans-serif}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{margin:0;padding:0}input,select,textarea{font-size:100%}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}abbr,acronym{border:0;font-variant:normal}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}ol,ul{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:500}q:before,q:after{content:''}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a:hover{text-decoration:underline}ins,a{text-decoration:none}",
            b = document.createElement("style");
        if (document.getElementsByTagName("head")[0].appendChild(b),
            b.styleSheet)
            b.styleSheet.disabled || (b.styleSheet.cssText = a);
        else
            try {
                b.innerHTML = a
            } catch (c) {
                b.innerText = a
            }
    }();
    ! function (a, b) {
        function c() {
            var b = f.getBoundingClientRect().width;
            b / i > 540 && (b = 540 * i);
            var c = b / 10;
            f.style.fontSize = c + "px",
                k.rem = a.rem = c
        }
        var d, e = a.document,
            f = e.documentElement,
            g = e.querySelector('meta[name="viewport"]'),
            h = e.querySelector('meta[name="flexible"]'),
            i = 0,
            j = 0,
            k = b.flexible || (b.flexible = {});
        if (g) {
            console.warn("将根据已有的meta标签来设置缩放比例");
            var l = g.getAttribute("content").match(/initial\-scale=([\d\.]+)/);
            l && (j = parseFloat(l[1]),
                i = parseInt(1 / j))
        } else if (h) {
            var m = h.getAttribute("content");
            if (m) {
                var n = m.match(/initial\-dpr=([\d\.]+)/),
                    o = m.match(/maximum\-dpr=([\d\.]+)/);
                n && (i = parseFloat(n[1]),
                        j = parseFloat((1 / i).toFixed(2))),
                    o && (i = parseFloat(o[1]),
                        j = parseFloat((1 / i).toFixed(2)))
            }
        }
        if (!i && !j) {
            var p = (a.navigator.appVersion.match(/android/gi),
                    a.navigator.appVersion.match(/iphone/gi)),
                q = a.devicePixelRatio;
            i = p ? q >= 3 && (!i || i >= 3) ? 3 : q >= 2 && (!i || i >= 2) ? 2 : 1 : 1,
                j = 1 / i
        }
        if (f.setAttribute("data-dpr", i),
            !g)
            if (g = e.createElement("meta"),
                g.setAttribute("name", "viewport"),
                g.setAttribute("content", "initial-scale=" + j + ", maximum-scale=" + j + ", minimum-scale=" + j +
                    ", user-scalable=no"),
                f.firstElementChild)
                f.firstElementChild.appendChild(g);
            else {
                var r = e.createElement("div");
                r.appendChild(g),
                    e.write(r.innerHTML)
            }
        a.addEventListener("resize", function () {
                clearTimeout(d),
                    d = setTimeout(c, 300)
            }, !1),
            a.addEventListener("pageshow", function (a) {
                a.persisted && (clearTimeout(d),
                    d = setTimeout(c, 300))
            }, !1),
            "complete" === e.readyState ? e.body.style.fontSize = 12 * i + "px" : e.addEventListener("DOMContentLoaded",
                function () {
                    e.body.style.fontSize = 12 * i + "px"
                }, !1),
            c(),
            k.dpr = a.dpr = i,
            k.refreshRem = c,
            k.rem2px = function (a) {
                var b = parseFloat(a) * this.rem;
                return "string" == typeof a && a.match(/rem$/) && (b += "px"),
                    b
            },
            k.px2rem = function (a) {
                var b = parseFloat(a) / this.rem;
                return "string" == typeof a && a.match(/px$/) && (b += "rem"),
                    b
            }
    }(window, window.lib || (window.lib = {}));
</script>
<script src="https://cdn.bootcdn.net/ajax/libs/mui/3.7.1/js/mui.min.js"></script>
<script type="text/javascript" src="./iminPrint.js"></script>
<script type="text/javascript" src="./dom-to-image.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.9.1/vconsole.min.js"></script>
<!-- <script crossorigin="anonymous" integrity="sha384-qSrEYLMHSuUya7HioxgwmVKxoqyVbT2Xmu87cJyVwFm1oq4M6Tz5lcdiFrOrS93l"
    src="https://lib.baomitu.com/fastclick/1.0.6/fastclick.min.js"></script> -->
<script type="text/javascript">
    var vConsole = new VConsole();
    // $(function () {
    //     FastClick.attach(document.body);
    // });
    $('.mobile-select-box').off('click').on('click', function (e) {
        e.stopPropagation();
        $('.mobile-select-box').addClass('focus')
        $('.mobile-select-list').slideDown(200)
    })
    var IminPrintInstance = iminPrint();
    $('.mobile-select-box .mobile-select-list .mobile-select-list-item').off('click').on('click', function (e) {
        e.stopPropagation();
        $(this).addClass('selectd').siblings().removeClass('selectd')
        $('.mobile-select-selectd').text($(this).text())
        $('.mobile-select-box').removeClass('focus')
        $('.mobile-select-list').slideUp(200)
        IminPrintInstance.ws.close()
        if (!$(this).index()) {
          
            mui.prompt('Please enter Custom IP:', '127.0.0.1', 'set', ['cofirm', 'cancel'],
                function (e) {
                    if (e.index == 0) {
                        IminPrintInstance = iminPrint(e.value);
                        init(IminPrintInstance)
                    }
                })

        } else {
            init(IminPrintInstance)
        }


    })
    init(IminPrintInstance)
    // var IminPrintInstance = iminPrint('ws://10.0.21.147:8081/websocket');

    // var IminPrintInstance = iminPrint('ws://10.0.21.90:8081/websocket');
    // var IminPrintInstance = iminPrint('ws://localhost:8081/websocket');
    // var IminPrintInstance = iminPrint();
    function init(Instance) {
        //初始化连接
        Instance.connect(function (ws) {
            // soket状态已链接
            if (ws.readyState == ws.OPEN) {
                var QrCodeSize;
                mui('body').on('tap', '.print-box .print-box-item', function (e) {
                    e.preventDefault();

                   
                            var node = document.getElementById('PrintContent');
                            domtoimage.toJpeg(node).then(function (dataUrl) {
                                IminPrintInstance.printSingleBitmap(dataUrl);
                                IminPrintInstance.partialCut();
                                // IminPrintInstance.printAndFeedPaper(200);    
                                // cutPaper(Instance);                            
                            });
                           
                })

            }
        });

    }

    // function cutPaper(Instance) {
    //     Instance.connect(function (ws) {
    //         if(ws.readyState == ws.OPEN) {
    //             ImitPrintInstance.partialCut();
    //         }
    //     })
    // }
</script>